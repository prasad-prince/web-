<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reports - Study Tracker</title>
  <link rel="stylesheet" href="css/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      transition: background 0.3s ease;
    }
    body.dark-mode {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    }
    .reports-container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .reports-card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      padding: 30px;
      transition: all 0.3s ease;
      animation: fadeIn 0.6s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    body.dark-mode .reports-card {
      background: #2d2d2d;
      color: #f0f0f0;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    }
    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .analytics-card {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
      animation: fadeIn 0.8s ease;
    }
    .analytics-card:hover {
      transform: translateY(-5px);
    }
    body.dark-mode .analytics-card {
      background: #3d3d3d;
      color: #f0f0f0;
    }
    .analytics-value {
      font-size: 36px;
      font-weight: 700;
      color: #4CAF50;
      margin: 10px 0;
    }
    body.dark-mode .analytics-value {
      color: #66bb6a;
    }
    .export-buttons {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 30px;
    }
    .export-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .export-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .export-pdf {
      background: #dc3545;
      color: white;
    }
    .export-excel {
      background: #28a745;
      color: white;
    }
    .back-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    .back-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      color: white;
    }
  </style>
</head>
<body class="light-mode">
  <div class="reports-container">
    <div class="reports-card">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-chart-bar"></i> Reports & Analytics</h2>
        <div>
          <a href="dashboard.html" class="back-btn me-2">
            <i class="fas fa-arrow-left"></i> Back
          </a>
          <button class="btn btn-outline-dark" onclick="toggleDarkMode()">
            <i class="fas fa-moon"></i> Dark Mode
          </button>
        </div>
      </div>

      <div class="analytics-grid">
        <div class="analytics-card">
          <i class="fas fa-tasks" style="font-size: 32px; color: #4CAF50; margin-bottom: 10px;"></i>
          <h4>Total Tasks</h4>
          <div class="analytics-value" id="totalTasks">0</div>
          <p style="color: #999; font-size: 14px;">All tasks created</p>
        </div>
        <div class="analytics-card">
          <i class="fas fa-check-circle" style="font-size: 32px; color: #4CAF50; margin-bottom: 10px;"></i>
          <h4>Completed Tasks</h4>
          <div class="analytics-value" id="completedTasks">0</div>
          <p style="color: #999; font-size: 14px;">Tasks finished</p>
        </div>
        <div class="analytics-card">
          <i class="fas fa-percentage" style="font-size: 32px; color: #4CAF50; margin-bottom: 10px;"></i>
          <h4>Completion Rate</h4>
          <div class="analytics-value" id="completionRate">0%</div>
          <p style="color: #999; font-size: 14px;">Success percentage</p>
        </div>
        <div class="analytics-card">
          <i class="fas fa-book" style="font-size: 32px; color: #4CAF50; margin-bottom: 10px;"></i>
          <h4>Notes Created</h4>
          <div class="analytics-value" id="notesCount">0</div>
          <p style="color: #999; font-size: 14px;">Study materials</p>
        </div>
      </div>

      <div class="export-buttons">
        <button class="export-btn export-pdf" onclick="exportToPDF()">
          <i class="fas fa-file-pdf"></i> Export as PDF
        </button>
        <button class="export-btn export-excel" onclick="exportToExcel()">
          <i class="fas fa-file-excel"></i> Export as Excel
        </button>
      </div>
    </div>
  </div>

  <script>
    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
      document.body.classList.toggle("light-mode");
      const isDark = document.body.classList.contains("dark-mode");
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      const btn = document.querySelector('button[onclick="toggleDarkMode()"]');
      if (btn) {
        btn.innerHTML = isDark 
          ? '<i class="fas fa-sun"></i> Light Mode' 
          : '<i class="fas fa-moon"></i> Dark Mode';
      }
    }

    function loadAnalytics() {
      const tasks = JSON.parse(localStorage.getItem('userTasks') || '[]');
      const notes = JSON.parse(localStorage.getItem('userNotes') || '[]');
      
      const totalTasks = tasks.length;
      const completedTasks = tasks.filter(t => typeof t === 'object' && t.status === 'Done').length || 0;
      const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
      const notesCount = notes.length;

      document.getElementById('totalTasks').textContent = totalTasks;
      document.getElementById('completedTasks').textContent = completedTasks;
      document.getElementById('completionRate').textContent = completionRate + '%';
      document.getElementById('notesCount').textContent = notesCount;
    }

    function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      const tasks = JSON.parse(localStorage.getItem('userTasks') || '[]');
      const notes = JSON.parse(localStorage.getItem('userNotes') || '[]');
      const completedTasks = tasks.filter(t => typeof t === 'object' && t.status === 'Done').length || 0;
      const completionRate = tasks.length > 0 ? Math.round((completedTasks / tasks.length) * 100) : 0;

      doc.setFontSize(20);
      doc.text('Study Tracker - Report', 20, 20);
      doc.setFontSize(12);
      doc.text(`Generated on: ${new Date().toLocaleString()}`, 20, 35);
      
      let y = 50;
      doc.setFontSize(16);
      doc.text('Analytics Summary', 20, y);
      y += 15;
      doc.setFontSize(12);
      doc.text(`Total Tasks: ${tasks.length}`, 20, y);
      y += 10;
      doc.text(`Completed Tasks: ${completedTasks}`, 20, y);
      y += 10;
      doc.text(`Completion Rate: ${completionRate}%`, 20, y);
      y += 10;
      doc.text(`Notes Created: ${notes.length}`, 20, y);
      
      y += 20;
      doc.setFontSize(16);
      doc.text('Task Details', 20, y);
      y += 10;
      doc.setFontSize(10);
      tasks.forEach((task, idx) => {
        const taskObj = typeof task === 'object' ? task : { text: task, status: 'Pending', priority: 'medium' };
        if (y > 280) {
          doc.addPage();
          y = 20;
        }
        doc.text(`${idx + 1}. ${taskObj.text || task} [${taskObj.status || 'Pending'}]`, 20, y);
        y += 8;
      });

      doc.save('study-tracker-report.pdf');
    }

    function exportToExcel() {
      const tasks = JSON.parse(localStorage.getItem('userTasks') || '[]');
      const notes = JSON.parse(localStorage.getItem('userNotes') || '[]');
      
      let csv = 'Task,Status,Priority,Deadline\n';
      tasks.forEach(task => {
        const taskObj = typeof task === 'object' ? task : { text: task, status: 'Pending', priority: 'medium', deadline: '' };
        csv += `"${taskObj.text || task}","${taskObj.status || 'Pending'}","${taskObj.priority || 'medium'}","${taskObj.deadline || 'N/A'}"\n`;
      });
      
      csv += '\n\nNotes\n';
      notes.forEach((note, idx) => {
        const noteObj = typeof note === 'object' ? note : { text: note };
        csv += `Note ${idx + 1},"${(noteObj.text || note).replace(/"/g, '""')}"\n`;
      });

      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'study-tracker-report.csv';
      a.click();
      URL.revokeObjectURL(url);
    }

    window.addEventListener('DOMContentLoaded', function() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
        document.body.classList.remove('light-mode');
        const btn = document.querySelector('button[onclick="toggleDarkMode()"]');
        if (btn) btn.innerHTML = '<i class="fas fa-sun"></i> Light Mode';
      }
      loadAnalytics();
    });
  </script>
</body>
</html>
