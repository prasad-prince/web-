<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calculator | Study Tracker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="css/style.css"/>
  <style>
    .calculator {
      max-width: 400px;
      margin: auto;
      padding: 30px;
      background-color: var(--bs-light);
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.15);
    }

    .calculator input {
      height: 60px;
      font-size: 1.5rem;
    }

    .calculator .btn {
      font-size: 1.3rem;
      padding: 15px;
    }

    body.dark-mode .calculator {
      background-color: #333;
      color: white;
    }

    body.dark-mode .form-control {
      background-color: #444;
      color: white;
      border: 1px solid #555;
    }

    body.dark-mode .btn {
      border: 1px solid white;
    }
  </style>
</head>
<body class="light-mode">

<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-center flex-grow-1"><i class="fas fa-calculator"></i> Calculator</h2>
    <div>
      <a href="dashboard.html" class="btn btn-outline-primary me-2">
        <i class="fas fa-arrow-left"></i> Back
      </a>
      <button class="btn btn-outline-dark" onclick="toggleDarkMode()">
        <i class="fas fa-moon"></i> Dark Mode
      </button>
    </div>
  </div>

  <div class="calculator">
    <div class="small text-muted text-end" id="history"></div>
    <input type="text" id="display" class="form-control text-end mb-3" placeholder="0" readonly />

    <div class="row g-2">
      <div class="col-3"><button class="btn btn-outline-danger w-100" onclick="clearAll()"><i class="fa-solid fa-a"></i><sub>C</sub></button></div>
      <div class="col-3"><button class="btn btn-outline-secondary w-100" onclick="deleteLast()"><i class="fa-solid fa-delete-left"></i></button></div>
      <div class="col-3"><button class="btn btn-outline-secondary w-100" onclick="percent()">%</button></div>
      <div class="col-3"><button class="btn btn-warning w-100" onclick="appendOperator('/')">/</button></div>

      <div class="col-3"><button class="btn btn-secondary w-100" onclick="appendValue('7')">7</button></div>
      <div class="col-3"><button class="btn btn-secondary w-100" onclick="appendValue('8')">8</button></div>
      <div class="col-3"><button class="btn btn-secondary w-100" onclick="appendValue('9')">9</button></div>
      <div class="col-3"><button class="btn btn-warning w-100" onclick="appendOperator('*')">*</button></div>

      <div class="col-3"><button class="btn btn-secondary w-100" onclick="appendValue('4')">4</button></div>
      <div class="col-3"><button class="btn btn-secondary w-100" onclick="appendValue('5')">5</button></div>
      <div class="col-3"><button class="btn btn-secondary w-100" onclick="appendValue('6')">6</button></div>
      <div class="col-3"><button class="btn btn-warning w-100" onclick="appendOperator('-')">-</button></div>

      <div class="col-3"><button class="btn btn-secondary w-100" onclick="appendValue('1')">1</button></div>
      <div class="col-3"><button class="btn btn-secondary w-100" onclick="appendValue('2')">2</button></div>
      <div class="col-3"><button class="btn btn-secondary w-100" onclick="appendValue('3')">3</button></div>
      <div class="col-3"><button class="btn btn-warning w-100" onclick="appendOperator('+')">+</button></div>

      <div class="col-3"><button class="btn btn-outline-secondary w-100" onclick="toggleSign()">+/-</button></div>
      <div class="col-3"><button class="btn btn-secondary w-100" onclick="appendValue('0')">0</button></div>
      <div class="col-3"><button class="btn btn-secondary w-100" onclick="appendDot()">.</button></div>
      <div class="col-3"><button class="btn btn-success w-100" onclick="calculate()">=</button></div>
    </div>
  </div>

</div>

<script>
  function getDisplay() { return document.getElementById('display'); }

  function appendValue(value) {
    const display = getDisplay();
    display.value += value;
  }

  function appendOperator(op) {
    const display = getDisplay();
    const v = display.value;
    if (!v) return; // don't start with operator
    if (/[+\-*/]$/.test(v)) {
      display.value = v.replace(/[+\-*/]$/, op);
    } else {
      display.value += op;
    }
  }

  function clearAll() {
    getDisplay().value = '';
    document.getElementById('history').textContent = '';
  }

  function deleteLast() {
    const display = getDisplay();
    display.value = display.value.slice(0, -1);
  }

  function appendDot() {
    const display = getDisplay();
    const v = display.value;
    const parts = v.split(/[+\-*/]/);
    const last = parts[parts.length - 1];
    if (!last.includes('.')) display.value += '.';
  }

  function toggleSign() {
    const display = getDisplay();
    const v = display.value;
    if (!v) return;
    const parts = v.split(/([+\-*/])/);
    // Find last number index
    for (let i = parts.length - 1; i >= 0; i--) {
      if (!/[+\-*/]/.test(parts[i]) && parts[i] !== '') {
        const num = parts[i].startsWith('-') ? parts[i].slice(1) : '-' + parts[i];
        parts[i] = num;
        display.value = parts.join('');
        return;
      }
    }
  }

  function percent() {
    const display = getDisplay();
    const v = display.value;
    if (!v) return;
    try {
      // Apply % to the last number only
      const parts = v.split(/([+\-*/])/);
      for (let i = parts.length - 1; i >= 0; i--) {
        if (!/[+\-*/]/.test(parts[i]) && parts[i] !== '') {
          const n = parseFloat(parts[i]);
          if (!isNaN(n)) parts[i] = String(n / 100);
          break;
        }
      }
      display.value = parts.join('');
    } catch {}
  }

  function calculate() {
    const display = getDisplay();
    const expr = display.value;
    if (!expr) return;
    try {
      if (/[+\-*/]$/.test(expr)) throw new Error('dangling operator');
      const result = Function('return ' + expr)();
      if (typeof result === 'number' && isFinite(result)) {
        document.getElementById('history').textContent = expr + ' =';
        display.value = String(result);
      } else {
        throw new Error('Invalid result');
      }
    } catch {
      alert('Invalid expression');
    }
  }

  function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    document.body.classList.toggle('light-mode');
    const isDark = document.body.classList.contains('dark-mode');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    
    const btn = document.querySelector('button[onclick="toggleDarkMode()"]');
    if (btn) {
      btn.innerHTML = isDark 
        ? '<i class="fas fa-sun"></i> Light Mode' 
        : '<i class="fas fa-moon"></i> Dark Mode';
    }
  }
  
  // Load saved theme
  window.addEventListener('DOMContentLoaded', function() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    if (savedTheme === 'dark') {
      document.body.classList.add('dark-mode');
      document.body.classList.remove('light-mode');
      const btn = document.querySelector('button[onclick="toggleDarkMode()"]');
      if (btn) btn.innerHTML = '<i class="fas fa-sun"></i> Light Mode';
    }
    // Keyboard support
    document.addEventListener('keydown', (e) => {
      const k = e.key;
      if (/^[0-9]$/.test(k)) appendValue(k);
      else if (k === '.') appendDot();
      else if (k === '+' || k === '-' || k === '*' || k === '/') appendOperator(k);
      else if (k === 'Enter' || k === '=') { e.preventDefault(); calculate(); }
      else if (k === 'Backspace') { e.preventDefault(); deleteLast(); }
      else if (k === 'Escape' || k === 'Delete') { e.preventDefault(); clearAll(); }
      else if (k === '%') percent();
    });
  });
</script>

</body>
</html>
